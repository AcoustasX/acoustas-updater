<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Acoustas AC650 Firmware Updater</title>
  <meta name="description" content="Update your Acoustas AC650 amplifier firmware via USB">
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <div class="header-brand">
        <h1 class="logo">ACOUSTAS</h1>
        <span class="logo-sub">AC650 Firmware Updater</span>
      </div>
      <button id="adminToggle" class="admin-toggle" title="Admin Login">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
          <path d="M7 11V7a5 5 0 0 1 10 0v4" />
        </svg>
      </button>
    </header>

    <!-- Admin Password Modal -->
    <div id="adminModal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-content">
        <h2>Admin Access</h2>
        <p>Enter admin password to unlock serial number configuration.</p>
        <input type="password" id="adminPassword" class="input-field" placeholder="Password" autocomplete="off">
        <div class="modal-actions">
          <button id="adminCancel" class="btn btn-secondary">Cancel</button>
          <button id="adminSubmit" class="btn btn-primary">Unlock</button>
        </div>
        <p id="adminError" class="error-text hidden">Incorrect password</p>
      </div>
    </div>

    <!-- Main content -->
    <main class="main">
      <!-- Before You Begin -->
      <section class="step prep-section">
        <h2 class="step-title">
          <svg class="prep-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2">
            <path
              d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z" />
          </svg>
          Before You Begin
        </h2>
        <p class="step-description">Prepare your amplifier for the firmware update.</p>

        <div class="prep-steps">
          <div class="prep-step">
            <span class="prep-step-num">1</span>
            <div>
              <strong>Open the amplifier</strong><br>
              <span class="prep-detail">Remove the four M3 bolts from the top panel using a 2&nbsp;mm hex driver (Allen
                wrench).<br>Lift off the top lid to expose the circuit board.</span>
            </div>
          </div>
          <div class="prep-step">
            <span class="prep-step-num">2</span>
            <div>
              <strong>Locate the USB port</strong><br>
              <span class="prep-detail">On the circuit board you'll see two small buttons labeled <strong>RESET</strong>
                and <strong>BOOT</strong>, and a micro USB port next to them.</span>
            </div>
          </div>
          <div class="prep-step">
            <span class="prep-step-num">3</span>
            <div>
              <strong>Connect the USB cable</strong><br>
              <span class="prep-detail">Plug a <strong>micro USB cable</strong> into the port on the board, and the
                other end into your computer.</span>
            </div>
          </div>
          <div class="prep-step">
            <span class="prep-step-num">4</span>
            <div>
              <strong>Connect main power</strong><br>
              <span class="prep-detail">Make sure the amplifier's main power cord is plugged in. The amp does not need
                to be turned on — just connected to power.</span>
            </div>
          </div>
        </div>

        <!-- YouTube video placeholder -->
        <div class="video-placeholder">
          <a id="videoLink" href="#" target="_blank" class="video-thumb">
            <div class="video-play">▶</div>
            <span class="video-label">Watch the setup video</span>
          </a>
          <p class="video-hint">Video walkthrough coming soon</p>
        </div>
      </section>

      <!-- Step 1: Select your amplifier -->
      <section class="step" id="stepSelect">
        <h2 class="step-title">
          <span class="step-number">1</span>
          Select Your Amplifier
        </h2>
        <p class="step-description">Click the image that matches your AC650 amplifier.</p>

        <div class="amp-grid">
          <button class="amp-card" data-config="0" data-name="AC650 Black (Original)">
            <div class="amp-image-wrap">
              <img src="images/acoustas_ac650_black.png" alt="AC650 Black Original" class="amp-image">
            </div>
            <div class="amp-label">AC650 Black</div>
            <div class="amp-sublabel">Original</div>
            <div class="amp-check">✓</div>
          </button>

          <button class="amp-card" data-config="2" data-name="AC650 White">
            <div class="amp-image-wrap">
              <img src="images/acoustas_ac650_white.png" alt="AC650 White" class="amp-image">
            </div>
            <div class="amp-label">AC650 White</div>
            <div class="amp-sublabel">Original</div>
            <div class="amp-check">✓</div>
          </button>

          <button class="amp-card" data-config="3" data-name="AC650 Black v2">
            <div class="amp-image-wrap">
              <img src="images/acoustas_ac650_black2.png" alt="AC650 Black v2" class="amp-image">
            </div>
            <div class="amp-label">AC650 Black</div>
            <div class="amp-sublabel">Version 2</div>
            <div class="amp-check">✓</div>
          </button>
        </div>

        <!-- Admin serial number field -->
        <div id="serialSection" class="serial-section hidden">
          <label for="serialInput" class="serial-label">Serial Number (Admin)</label>
          <input type="number" id="serialInput" class="input-field" placeholder="Enter serial number" min="0">
        </div>
      </section>

      <!-- Step 2: Connect -->
      <section class="step" id="stepConnect">
        <h2 class="step-title">
          <span class="step-number">2</span>
          Connect Your Amplifier
        </h2>
        <p class="step-description">
          Click the Connect button below. A popup will appear — select <strong>"USB JTAG/serial debug unit"</strong> and
          click Connect.
        </p>
        <div class="connect-row">
          <button id="connectBtn" class="btn btn-primary btn-large" disabled>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2v6m0 0l3-3m-3 3L9 5" />
              <rect x="6" y="8" width="12" height="12" rx="2" />
            </svg>
            Connect via USB
          </button>
          <div id="connectionStatus" class="connection-status">
            <span class="status-dot"></span>
            <span class="status-text">Not connected</span>
          </div>
        </div>
      </section>

      <!-- Step 3: Flash -->
      <section class="step" id="stepFlash">
        <h2 class="step-title">
          <span class="step-number">3</span>
          Update Firmware
        </h2>
        <div id="flashContent">
          <div class="flash-info">
            <div class="flash-info-row">
              <span class="flash-info-label">Amplifier:</span>
              <span id="flashAmpName" class="flash-info-value">—</span>
            </div>
            <div class="flash-info-row">
              <span class="flash-info-label">Config:</span>
              <span id="flashConfigValue" class="flash-info-value">—</span>
            </div>
            <div class="flash-info-row hidden" id="flashSerialRow">
              <span class="flash-info-label">Serial:</span>
              <span id="flashSerialValue" class="flash-info-value">—</span>
            </div>
            <div class="flash-info-row">
              <span class="flash-info-label">Firmware:</span>
              <span class="flash-info-value">v1.5.9</span>
            </div>
          </div>
          <div class="erase-option">
            <label class="checkbox-label">
              <input type="checkbox" id="fullEraseCheck">
              <span class="checkbox-custom"></span>
              <span>Full Erase (reset all settings)</span>
            </label>
            <p class="erase-hint">Leave unchecked to preserve Wi-Fi and provisioning data. Only check this if you are
              experiencing issues.</p>
          </div>
          <button id="flashBtn" class="btn btn-accent btn-large" disabled>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
            </svg>
            Flash Firmware
          </button>
        </div>

        <!-- Progress -->
        <div id="progressSection" class="progress-section hidden">
          <div class="progress-bar-wrap">
            <div id="progressBar" class="progress-bar" style="width: 0%"></div>
          </div>
          <div class="progress-text">
            <span id="progressLabel">Preparing...</span>
            <span id="progressPercent">0%</span>
          </div>
        </div>

        <!-- Success -->
        <div id="successSection" class="success-section hidden">
          <div class="success-icon">✓</div>
          <h3 class="success-title">Update Complete!</h3>
          <p class="success-text">
            Your AC650 firmware has been updated successfully.<br>
            Follow these steps to finish:
          </p>
          <div class="post-flash-steps">
            <div class="post-step">
              <span class="post-step-num">1</span>
              <span>Disconnect the USB cable from the circuit board</span>
            </div>
            <div class="post-step">
              <span class="post-step-num">2</span>
              <span>Unplug the power cord from the amplifier</span>
            </div>
            <div class="post-step">
              <span class="post-step-num">3</span>
              <span>Replace the top lid and secure the four M3 bolts</span>
            </div>
            <div class="post-step">
              <span class="post-step-num">4</span>
              <span>Plug the power cord back in and turn on your amplifier</span>
            </div>
          </div>
          <p class="success-note">Your Wi-Fi settings have been preserved — the amplifier should reconnect
            automatically.</p>
          <button id="resetBtn" class="btn btn-secondary">Flash Another</button>
        </div>

        <!-- Error -->
        <div id="errorSection" class="error-section hidden">
          <div class="error-icon">✕</div>
          <h3 class="error-title">Update Failed</h3>
          <p id="errorMessage" class="error-text"></p>
          <button id="retryBtn" class="btn btn-secondary">Try Again</button>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <p>Requires Google Chrome or Microsoft Edge. &nbsp;|&nbsp; USB cable required.</p>
      <p class="footer-copy">© 2026 Acoustas. All rights reserved.</p>
    </footer>
  </div>

  <!-- Console log panel -->
  <div id="logPanel" class="log-panel hidden">
    <div class="log-header">
      <span>Console</span>
      <button id="logClose" class="log-close">✕</button>
    </div>
    <pre id="logOutput" class="log-output"></pre>
  </div>
  <button id="logToggle" class="log-toggle" title="Toggle console log">⌥</button>

  <script type="module" src="app.js"></script>
</body>

</html>